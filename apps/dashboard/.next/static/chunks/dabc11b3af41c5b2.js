(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,70683,(e,t,a)=>{t.exports=e.r(51437)},14493,e=>{"use strict";e.i(28599);var t=e.i(28961),a=e.i(29281);let r={ORGANIZATIONS:"organizations",ORGANIZATION_MEMBERS:"organization_members",PROJECTS:"projects",ENVIRONMENTS:"environments",FEATURE_FLAGS:"feature_flags",FLAG_VALUES:"flag_values",API_KEYS:"api_keys",AUDIT_LOGS:"audit_logs",FLAG_ANALYTICS:"flag_analytics"};async function s(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.ORGANIZATIONS),{...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});return await (0,t.setDoc)((0,t.doc)(a.db,r.ORGANIZATION_MEMBERS,`${e.createdBy}_${s.id}`),{organizationId:s.id,userId:e.createdBy,role:"owner",createdAt:(0,t.serverTimestamp)()}),s.id}async function l(e){let s=(0,t.query)((0,t.collection)(a.db,r.ORGANIZATION_MEMBERS),(0,t.where)("userId","==",e)),l=(await (0,t.getDocs)(s)).docs.map(e=>e.data().organizationId);if(0===l.length)return[];let n=(0,t.query)((0,t.collection)(a.db,r.ORGANIZATIONS),(0,t.where)("__name__","in",l));return(await (0,t.getDocs)(n)).docs.map(e=>({id:e.id,...e.data()}))}async function n(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.PROJECTS),{...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});for(let e of[{name:"Development",key:"dev"},{name:"Staging",key:"staging"},{name:"Production",key:"prod"}])await (0,t.addDoc)((0,t.collection)(a.db,r.ENVIRONMENTS),{projectId:s.id,...e,createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()});return s.id}async function i(e){let s=await (0,t.addDoc)((0,t.collection)(a.db,r.FEATURE_FLAGS),{...e,tags:e.tags||[],createdAt:(0,t.serverTimestamp)(),updatedAt:(0,t.serverTimestamp)()}),l=(0,t.query)((0,t.collection)(a.db,r.ENVIRONMENTS),(0,t.where)("projectId","==",e.projectId));for(let n of(await (0,t.getDocs)(l)).docs)await (0,t.addDoc)((0,t.collection)(a.db,r.FLAG_VALUES),{flagId:s.id,environmentId:n.id,enabled:!1,value:e.defaultValue,updatedAt:(0,t.serverTimestamp)()});return s}async function d(s){let l=(await e.A(43979)).default,n=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(e=>e.toString(16).padStart(2,"0")).join(""),i=`fsk_${s.keyType}_${n}`,d=await l.hash(i,10),o=i.substring(0,12);return await (0,t.addDoc)((0,t.collection)(a.db,r.API_KEYS),{environmentId:s.environmentId,name:s.name,keyPrefix:o,keyHash:d,keyType:s.keyType,revoked:!1,lastUsedAt:null,createdAt:(0,t.serverTimestamp)(),createdBy:s.createdBy}),i}async function o(e){let s=(0,t.doc)(a.db,r.API_KEYS,e);await (0,t.updateDoc)(s,{revoked:!0,updatedAt:(0,t.serverTimestamp)()})}async function c(e){let s=(0,t.query)((0,t.collection)(a.db,r.API_KEYS),(0,t.where)("environmentId","==",e),(0,t.where)("revoked","==",!1));return(await (0,t.getDocs)(s)).docs.map(e=>({id:e.id,...e.data()}))}async function u(e){return await (0,t.addDoc)((0,t.collection)(a.db,r.AUDIT_LOGS),{...e,timestamp:(0,t.serverTimestamp)(),createdAt:(0,t.serverTimestamp)()})}async function g(e,s=100){let l=(0,t.query)((0,t.collection)(a.db,r.AUDIT_LOGS),(0,t.where)("organizationId","==",e));return(await (0,t.getDocs)(l)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{let a=e.timestamp?.toMillis()||e.createdAt?.toMillis()||0;return(t.timestamp?.toMillis()||t.createdAt?.toMillis()||0)-a}).slice(0,s)}async function m(e,s,l=7){let n=(0,t.query)((0,t.collection)(a.db,r.FLAG_ANALYTICS),(0,t.where)("projectId","==",e),(0,t.where)("environmentId","==",s)),i=(await (0,t.getDocs)(n)).docs.map(e=>({id:e.id,...e.data()})),d=Date.now()-24*l*36e5;return i.filter(e=>(e.timestamp?.toMillis()||e.createdAt?.toMillis()||0)>=d)}async function x(e,t,a=7){let r=await m(e,t,a),s={};return r.forEach(e=>{let t=e.flagKey;s[t]||(s[t]={flagKey:t,flagId:e.flagId,evaluations:0,uniqueUsers:new Set,trueCount:0,falseCount:0,targetingAppliedCount:0}),s[t].evaluations++,e.userId&&s[t].uniqueUsers.add(e.userId),!0===e.result&&s[t].trueCount++,!1===e.result&&s[t].falseCount++,e.targetingApplied&&s[t].targetingAppliedCount++}),Object.values(s).map(e=>({...e,uniqueUsers:e.uniqueUsers.size}))}e.s(["COLLECTIONS",0,r,"createApiKey",()=>d,"createAuditLog",()=>u,"createFeatureFlag",()=>i,"createOrganization",()=>s,"createProject",()=>n,"getAggregatedAnalytics",()=>x,"getAuditLogs",()=>g,"getEnvironmentApiKeys",()=>c,"getUserOrganizations",()=>l,"revokeApiKey",()=>o])},77848,e=>{"use strict";var t=e.i(83769),a=e.i(70683),r=e.i(91672);e.i(28599);var s=e.i(28961),l=e.i(29281),n=e.i(14493);e.i(32555);var i=e.i(79457),d=e.i(1040);function o(){let e=(0,a.useParams)(),o=(0,a.useRouter)(),[c,u]=(0,r.useState)(null),[g,m]=(0,r.useState)(null),[x,p]=(0,r.useState)([]),[b,h]=(0,r.useState)(""),[y,f]=(0,r.useState)(null),[v,N]=(0,r.useState)(!0),[j,w]=(0,r.useState)("settings"),[A,I]=(0,r.useState)({enabled:!1,rules:[],defaultRule:{rolloutPercentage:100,value:!0}});async function S(){try{let t=(0,s.query)((0,s.collection)(l.db,n.COLLECTIONS.FEATURE_FLAGS),(0,s.where)("key","==",e.flagKey)),a=await (0,s.getDocs)(t);if(a.empty)return void o.push(`/dashboard/${e.slug}/projects/${e.projectKey}`);let r=a.docs[0];m({id:r.id,...r.data()});let i=(0,s.query)((0,s.collection)(l.db,n.COLLECTIONS.ENVIRONMENTS)),d=(await (0,s.getDocs)(i)).docs.map(e=>({id:e.id,...e.data()}));p(d),d.length>0&&h(d[0].id),N(!1)}catch(e){console.error("Error loading flag:",e),N(!1)}}async function T(){try{let e=(0,s.query)((0,s.collection)(l.db,n.COLLECTIONS.FLAG_VALUES),(0,s.where)("flagId","==",g.id),(0,s.where)("environmentId","==",b)),t=await (0,s.getDocs)(e);if(!t.empty){let e=t.docs[0],a={id:e.id,...e.data()};f(a),a.targeting&&I(a.targeting)}}catch(e){console.error("Error loading flag value:",e)}}async function E(){if(y)try{let e=!y.enabled;await (0,s.updateDoc)((0,s.doc)(l.db,n.COLLECTIONS.FLAG_VALUES,y.id),{enabled:e,updatedAt:new Date}),f({...y,enabled:e})}catch(e){console.error("Error toggling flag:",e),alert("Failed to toggle flag")}}async function C(){if(y&&c&&g)try{let e=y.targeting;await (0,s.updateDoc)((0,s.doc)(l.db,n.COLLECTIONS.FLAG_VALUES,y.id),{targeting:A,updatedAt:new Date}),await (0,n.createAuditLog)({organizationId:g.organizationId||"",projectId:g.projectId,environmentId:b,userId:c.uid,userEmail:c.email||"unknown",action:"TARGETING_RULES_UPDATED",resourceType:"flag",resourceId:g.id,resourceName:g.name,changes:{before:e,after:A}}),d.default.success("âœ… Targeting rules saved successfully!")}catch(e){console.error("Error saving targeting:",e),d.default.error("âŒ Failed to save targeting rules")}}function O(e,t){I({...A,rules:A.rules.map(a=>a.id===e?{...a,...t}:a)})}function R(e,t,a){I({...A,rules:A.rules.map(r=>r.id===e?{...r,conditions:r.conditions.map((e,r)=>r===t?{...e,...a}:e)}:r)})}return(0,r.useEffect)(()=>{let e=(0,i.onAuthStateChanged)(l.auth,e=>{u(e)});return()=>e()},[]),(0,r.useEffect)(()=>{S()},[e.flagKey]),(0,r.useEffect)(()=>{b&&g&&T()},[b,g]),v?(0,t.jsx)("div",{className:"p-8",children:(0,t.jsx)("div",{className:"max-w-5xl mx-auto",children:(0,t.jsx)("p",{className:"text-gray-500",children:"Loading..."})})}):g?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,t.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("button",{onClick:()=>o.push(`/dashboard/${e.slug}/projects/${e.projectKey}`),className:"text-blue-600 hover:text-blue-700 mb-4 flex items-center gap-2 font-medium",children:"â† Back to Project"}),(0,t.jsx)("div",{className:"flex items-start justify-between bg-white p-6 rounded-lg shadow",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:g.name}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:g.description||"No description"}),(0,t.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,t.jsxs)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium",children:["Key: ",g.key]}),(0,t.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium",children:g.flagType})]})]})})]}),(0,t.jsxs)("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),(0,t.jsx)("select",{value:b,onChange:e=>h(e.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:x.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))})]}),(0,t.jsx)("div",{className:"bg-white rounded-lg shadow mb-6",children:(0,t.jsxs)("div",{className:"flex gap-1 p-2",children:[(0,t.jsx)("button",{onClick:()=>w("settings"),className:`flex-1 px-4 py-2 font-medium rounded-lg transition-colors ${"settings"===j?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"Settings"}),(0,t.jsx)("button",{onClick:()=>w("targeting"),className:`flex-1 px-4 py-2 font-medium rounded-lg transition-colors ${"targeting"===j?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"ðŸŽ¯ Targeting Rules"})]})}),"settings"===j&&(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6 pb-6 border-b",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flag Status"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Enable or disable this flag"})]}),(0,t.jsx)("button",{onClick:E,className:`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${y?.enabled?"bg-green-600":"bg-gray-300"}`,children:(0,t.jsx)("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow transition-transform ${y?.enabled?"translate-x-7":"translate-x-1"}`})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Flag Value"}),(0,t.jsx)("div",{className:"bg-gray-50 border border-gray-200 p-4 rounded-lg",children:(0,t.jsx)("pre",{className:"text-sm text-gray-800 font-mono",children:JSON.stringify(y?.value,null,2)})})]})]}),"targeting"===j&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Enable Targeting"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Use rules to target specific users"})]}),(0,t.jsx)("button",{onClick:()=>I({...A,enabled:!A.enabled}),className:`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${A.enabled?"bg-green-600":"bg-gray-300"}`,children:(0,t.jsx)("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow transition-transform ${A.enabled?"translate-x-7":"translate-x-1"}`})})]})}),A.enabled&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Targeting Rules"}),(0,t.jsx)("button",{onClick:function(){let e={id:`rule-${Date.now()}`,description:"New rule",conditions:[],rolloutPercentage:100,value:!0,enabled:!0};I({...A,rules:[...A.rules,e]})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-sm",children:"+ Add Rule"})]}),0===A.rules.length?(0,t.jsx)("p",{className:"text-gray-500 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:"No rules yet. Add a rule to start targeting specific users."}):(0,t.jsx)("div",{className:"space-y-4",children:A.rules.map((e,a)=>(0,t.jsx)("div",{className:"border-2 border-gray-200 rounded-lg p-5 space-y-4 bg-gray-50",children:(0,t.jsxs)("div",{className:"flex items-start justify-between",children:[(0,t.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,t.jsx)("input",{type:"text",value:e.description,onChange:t=>O(e.id,{description:t.target.value}),placeholder:"Rule description",className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("label",{className:"text-sm font-semibold text-gray-900",children:"Conditions (ALL must match)"}),(0,t.jsx)("button",{onClick:()=>{var t;let a;return t=e.id,a={attribute:"plan",operator:"eq",value:""},void I({...A,rules:A.rules.map(e=>e.id===t?{...e,conditions:[...e.conditions,a]}:e)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Condition"})]}),e.conditions.map((a,r)=>(0,t.jsxs)("div",{className:"flex gap-2 items-center bg-white p-3 rounded-lg border border-gray-300",children:[(0,t.jsx)("input",{type:"text",value:a.attribute,onChange:t=>R(e.id,r,{attribute:t.target.value}),placeholder:"attribute (e.g., plan)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900"}),(0,t.jsxs)("select",{value:a.operator,onChange:t=>R(e.id,r,{operator:t.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900",children:[(0,t.jsx)("option",{value:"eq",children:"equals"}),(0,t.jsx)("option",{value:"ne",children:"not equals"}),(0,t.jsx)("option",{value:"contains",children:"contains"}),(0,t.jsx)("option",{value:"in",children:"in"}),(0,t.jsx)("option",{value:"gt",children:"greater than"}),(0,t.jsx)("option",{value:"lt",children:"less than"}),(0,t.jsx)("option",{value:"gte",children:"â‰¥"}),(0,t.jsx)("option",{value:"lte",children:"â‰¤"})]}),(0,t.jsx)("input",{type:"text",value:a.value,onChange:t=>R(e.id,r,{value:t.target.value}),placeholder:"value",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900"}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void I({...A,rules:A.rules.map(e=>e.id===t?{...e,conditions:e.conditions.filter((e,t)=>t!==r)}:e)})},className:"text-red-600 hover:text-red-700 text-xl font-bold px-2",children:"Ã—"})]},r))]}),(0,t.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-300",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Rollout: ",e.rolloutPercentage,"%"]}),(0,t.jsx)("input",{type:"range",min:"0",max:"100",value:e.rolloutPercentage,onChange:t=>O(e.id,{rolloutPercentage:parseInt(t.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Return Value"}),(0,t.jsx)("input",{type:"text",value:JSON.stringify(e.value),onChange:t=>{try{O(e.id,{value:JSON.parse(t.target.value)})}catch{}},className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-mono bg-white text-gray-900"})]})]}),(0,t.jsx)("button",{onClick:()=>{var t;return t=e.id,void I({...A,rules:A.rules.filter(e=>e.id!==t)})},className:"ml-4 text-red-600 hover:text-red-700 text-2xl",children:"ðŸ—‘ï¸"})]})},e.id))})]}),(0,t.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Default Rule"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Applied when no rules match"}),(0,t.jsxs)("div",{className:"space-y-5",children:[(0,t.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,t.jsxs)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Rollout: ",A.defaultRule.rolloutPercentage,"%"]}),(0,t.jsx)("input",{type:"range",min:"0",max:"100",value:A.defaultRule.rolloutPercentage,onChange:e=>I({...A,defaultRule:{...A.defaultRule,rolloutPercentage:parseInt(e.target.value)}}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Default Value"}),(0,t.jsx)("input",{type:"text",value:JSON.stringify(A.defaultRule.value),onChange:e=>{try{I({...A,defaultRule:{...A.defaultRule,value:JSON.parse(e.target.value)}})}catch{}},className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg font-mono bg-white text-gray-900"})]})]})]}),(0,t.jsx)("button",{onClick:C,className:"w-full py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-lg text-lg",children:"ðŸ’¾ Save Targeting Rules"})]})]})]})}):null}e.s(["default",()=>o])},43979,e=>{e.v(t=>Promise.all(["static/chunks/405394a8b91a97fb.js"].map(t=>e.l(t))).then(()=>t(27430)))}]);