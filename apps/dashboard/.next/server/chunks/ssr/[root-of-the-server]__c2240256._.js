module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},91023,(a,b,c)=>{"use strict";b.exports=a.r(64194).vendored.contexts.AppRouterContext},71264,(a,b,c)=>{"use strict";b.exports=a.r(64194).vendored.contexts.HooksClientContext},31018,(a,b,c)=>{"use strict";b.exports=a.r(64194).vendored.contexts.ServerInsertedHtml},24361,(a,b,c)=>{b.exports=a.x("util",()=>require("util"))},14747,(a,b,c)=>{b.exports=a.x("path",()=>require("path"))},54799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},59834,a=>{"use strict";a.i(37013);var b=a.i(56622),c=a.i(12972);let d={ORGANIZATIONS:"organizations",ORGANIZATION_MEMBERS:"organization_members",PROJECTS:"projects",ENVIRONMENTS:"environments",FEATURE_FLAGS:"feature_flags",FLAG_VALUES:"flag_values",API_KEYS:"api_keys",AUDIT_LOGS:"audit_logs",FLAG_ANALYTICS:"flag_analytics"};async function e(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.ORGANIZATIONS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return await (0,b.setDoc)((0,b.doc)(c.db,d.ORGANIZATION_MEMBERS,`${a.createdBy}_${e.id}`),{organizationId:e.id,userId:a.createdBy,role:"owner",createdAt:(0,b.serverTimestamp)()}),e.id}async function f(a){let e=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATION_MEMBERS),(0,b.where)("userId","==",a)),f=(await (0,b.getDocs)(e)).docs.map(a=>a.data().organizationId);if(0===f.length)return[];let g=(0,b.query)((0,b.collection)(c.db,d.ORGANIZATIONS),(0,b.where)("__name__","in",f));return(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()}))}async function g(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.PROJECTS),{...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});for(let a of[{name:"Development",key:"dev"},{name:"Staging",key:"staging"},{name:"Production",key:"prod"}])await (0,b.addDoc)((0,b.collection)(c.db,d.ENVIRONMENTS),{projectId:e.id,...a,createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()});return e.id}async function h(a){let e=await (0,b.addDoc)((0,b.collection)(c.db,d.FEATURE_FLAGS),{...a,tags:a.tags||[],createdAt:(0,b.serverTimestamp)(),updatedAt:(0,b.serverTimestamp)()}),f=(0,b.query)((0,b.collection)(c.db,d.ENVIRONMENTS),(0,b.where)("projectId","==",a.projectId));for(let g of(await (0,b.getDocs)(f)).docs)await (0,b.addDoc)((0,b.collection)(c.db,d.FLAG_VALUES),{flagId:e.id,environmentId:g.id,enabled:!1,value:a.defaultValue,updatedAt:(0,b.serverTimestamp)()});return e}async function i(e){let f=(await a.A(71374)).default,g=Array.from(crypto.getRandomValues(new Uint8Array(16))).map(a=>a.toString(16).padStart(2,"0")).join(""),h=`fsk_${e.keyType}_${g}`,i=await f.hash(h,10),j=h.substring(0,12);return await (0,b.addDoc)((0,b.collection)(c.db,d.API_KEYS),{environmentId:e.environmentId,name:e.name,keyPrefix:j,keyHash:i,keyType:e.keyType,revoked:!1,lastUsedAt:null,createdAt:(0,b.serverTimestamp)(),createdBy:e.createdBy}),h}async function j(a){let e=(0,b.doc)(c.db,d.API_KEYS,a);await (0,b.updateDoc)(e,{revoked:!0,updatedAt:(0,b.serverTimestamp)()})}async function k(a){let e=(0,b.query)((0,b.collection)(c.db,d.API_KEYS),(0,b.where)("environmentId","==",a),(0,b.where)("revoked","==",!1));return(await (0,b.getDocs)(e)).docs.map(a=>({id:a.id,...a.data()}))}async function l(a){return await (0,b.addDoc)((0,b.collection)(c.db,d.AUDIT_LOGS),{...a,timestamp:(0,b.serverTimestamp)(),createdAt:(0,b.serverTimestamp)()})}async function m(a,e=100){let f=(0,b.query)((0,b.collection)(c.db,d.AUDIT_LOGS),(0,b.where)("organizationId","==",a));return(await (0,b.getDocs)(f)).docs.map(a=>({id:a.id,...a.data()})).sort((a,b)=>{let c=a.timestamp?.toMillis()||a.createdAt?.toMillis()||0;return(b.timestamp?.toMillis()||b.createdAt?.toMillis()||0)-c}).slice(0,e)}async function n(a,e,f=7){let g=(0,b.query)((0,b.collection)(c.db,d.FLAG_ANALYTICS),(0,b.where)("projectId","==",a),(0,b.where)("environmentId","==",e)),h=(await (0,b.getDocs)(g)).docs.map(a=>({id:a.id,...a.data()})),i=Date.now()-24*f*36e5;return h.filter(a=>(a.timestamp?.toMillis()||a.createdAt?.toMillis()||0)>=i)}async function o(a,b,c=7){let d=await n(a,b,c),e={};return d.forEach(a=>{let b=a.flagKey;e[b]||(e[b]={flagKey:b,flagId:a.flagId,evaluations:0,uniqueUsers:new Set,trueCount:0,falseCount:0,targetingAppliedCount:0}),e[b].evaluations++,a.userId&&e[b].uniqueUsers.add(a.userId),!0===a.result&&e[b].trueCount++,!1===a.result&&e[b].falseCount++,a.targetingApplied&&e[b].targetingAppliedCount++}),Object.values(e).map(a=>({...a,uniqueUsers:a.uniqueUsers.size}))}a.s(["COLLECTIONS",0,d,"createApiKey",()=>i,"createAuditLog",()=>l,"createFeatureFlag",()=>h,"createOrganization",()=>e,"createProject",()=>g,"getAggregatedAnalytics",()=>o,"getAuditLogs",()=>m,"getEnvironmentApiKeys",()=>k,"getUserOrganizations",()=>f,"revokeApiKey",()=>j])},74082,a=>{"use strict";var b=a.i(70888),c=a.i(82059),d=a.i(21387);a.i(37013);var e=a.i(56622),f=a.i(12972),g=a.i(59834);a.i(50402);var h=a.i(5107),i=a.i(94978);function j(){let a=(0,c.useParams)(),j=(0,c.useRouter)(),[k,l]=(0,d.useState)(null),[m,n]=(0,d.useState)(null),[o,p]=(0,d.useState)([]),[q,r]=(0,d.useState)(""),[s,t]=(0,d.useState)(null),[u,v]=(0,d.useState)(!0),[w,x]=(0,d.useState)("settings"),[y,z]=(0,d.useState)({enabled:!1,rules:[],defaultRule:{rolloutPercentage:100,value:!0}});async function A(){try{let b=(0,e.query)((0,e.collection)(f.db,g.COLLECTIONS.FEATURE_FLAGS),(0,e.where)("key","==",a.flagKey)),c=await (0,e.getDocs)(b);if(c.empty)return void j.push(`/dashboard/${a.slug}/projects/${a.projectKey}`);let d=c.docs[0];n({id:d.id,...d.data()});let h=(0,e.query)((0,e.collection)(f.db,g.COLLECTIONS.ENVIRONMENTS)),i=(await (0,e.getDocs)(h)).docs.map(a=>({id:a.id,...a.data()}));p(i),i.length>0&&r(i[0].id),v(!1)}catch(a){console.error("Error loading flag:",a),v(!1)}}async function B(){try{let a=(0,e.query)((0,e.collection)(f.db,g.COLLECTIONS.FLAG_VALUES),(0,e.where)("flagId","==",m.id),(0,e.where)("environmentId","==",q)),b=await (0,e.getDocs)(a);if(!b.empty){let a=b.docs[0],c={id:a.id,...a.data()};t(c),c.targeting&&z(c.targeting)}}catch(a){console.error("Error loading flag value:",a)}}async function C(){if(s)try{let a=!s.enabled;await (0,e.updateDoc)((0,e.doc)(f.db,g.COLLECTIONS.FLAG_VALUES,s.id),{enabled:a,updatedAt:new Date}),t({...s,enabled:a})}catch(a){console.error("Error toggling flag:",a),alert("Failed to toggle flag")}}async function D(){if(s&&k&&m)try{let a=s.targeting;await (0,e.updateDoc)((0,e.doc)(f.db,g.COLLECTIONS.FLAG_VALUES,s.id),{targeting:y,updatedAt:new Date}),await (0,g.createAuditLog)({organizationId:m.organizationId||"",projectId:m.projectId,environmentId:q,userId:k.uid,userEmail:k.email||"unknown",action:"TARGETING_RULES_UPDATED",resourceType:"flag",resourceId:m.id,resourceName:m.name,changes:{before:a,after:y}}),i.default.success("âœ… Targeting rules saved successfully!")}catch(a){console.error("Error saving targeting:",a),i.default.error("âŒ Failed to save targeting rules")}}function E(a,b){z({...y,rules:y.rules.map(c=>c.id===a?{...c,...b}:c)})}function F(a,b,c){z({...y,rules:y.rules.map(d=>d.id===a?{...d,conditions:d.conditions.map((a,d)=>d===b?{...a,...c}:a)}:d)})}return(0,d.useEffect)(()=>{let a=(0,h.onAuthStateChanged)(f.auth,a=>{l(a)});return()=>a()},[]),(0,d.useEffect)(()=>{A()},[a.flagKey]),(0,d.useEffect)(()=>{q&&m&&B()},[q,m]),u?(0,b.jsx)("div",{className:"p-8",children:(0,b.jsx)("div",{className:"max-w-5xl mx-auto",children:(0,b.jsx)("p",{className:"text-gray-500",children:"Loading..."})})}):m?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 p-8",children:(0,b.jsxs)("div",{className:"max-w-5xl mx-auto",children:[(0,b.jsxs)("div",{className:"mb-6",children:[(0,b.jsx)("button",{onClick:()=>j.push(`/dashboard/${a.slug}/projects/${a.projectKey}`),className:"text-blue-600 hover:text-blue-700 mb-4 flex items-center gap-2 font-medium",children:"â† Back to Project"}),(0,b.jsx)("div",{className:"flex items-start justify-between bg-white p-6 rounded-lg shadow",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:m.name}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:m.description||"No description"}),(0,b.jsxs)("div",{className:"flex gap-2 mt-3",children:[(0,b.jsxs)("span",{className:"px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-medium",children:["Key: ",m.key]}),(0,b.jsx)("span",{className:"px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-medium",children:m.flagType})]})]})})]}),(0,b.jsxs)("div",{className:"mb-6 bg-white p-4 rounded-lg shadow",children:[(0,b.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Environment"}),(0,b.jsx)("select",{value:q,onChange:a=>r(a.target.value),className:"px-4 py-2 border border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:o.map(a=>(0,b.jsx)("option",{value:a.id,children:a.name},a.id))})]}),(0,b.jsx)("div",{className:"bg-white rounded-lg shadow mb-6",children:(0,b.jsxs)("div",{className:"flex gap-1 p-2",children:[(0,b.jsx)("button",{onClick:()=>x("settings"),className:`flex-1 px-4 py-2 font-medium rounded-lg transition-colors ${"settings"===w?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"Settings"}),(0,b.jsx)("button",{onClick:()=>x("targeting"),className:`flex-1 px-4 py-2 font-medium rounded-lg transition-colors ${"targeting"===w?"bg-blue-600 text-white":"bg-white text-gray-600 hover:bg-gray-100"}`,children:"ðŸŽ¯ Targeting Rules"})]})}),"settings"===w&&(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6 pb-6 border-b",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Flag Status"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Enable or disable this flag"})]}),(0,b.jsx)("button",{onClick:C,className:`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${s?.enabled?"bg-green-600":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow transition-transform ${s?.enabled?"translate-x-7":"translate-x-1"}`})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Flag Value"}),(0,b.jsx)("div",{className:"bg-gray-50 border border-gray-200 p-4 rounded-lg",children:(0,b.jsx)("pre",{className:"text-sm text-gray-800 font-mono",children:JSON.stringify(s?.value,null,2)})})]})]}),"targeting"===w&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Enable Targeting"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Use rules to target specific users"})]}),(0,b.jsx)("button",{onClick:()=>z({...y,enabled:!y.enabled}),className:`relative inline-flex h-8 w-14 items-center rounded-full transition-colors ${y.enabled?"bg-green-600":"bg-gray-300"}`,children:(0,b.jsx)("span",{className:`inline-block h-6 w-6 transform rounded-full bg-white shadow transition-transform ${y.enabled?"translate-x-7":"translate-x-1"}`})})]})}),y.enabled&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Targeting Rules"}),(0,b.jsx)("button",{onClick:function(){let a={id:`rule-${Date.now()}`,description:"New rule",conditions:[],rolloutPercentage:100,value:!0,enabled:!0};z({...y,rules:[...y.rules,a]})},className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium shadow-sm",children:"+ Add Rule"})]}),0===y.rules.length?(0,b.jsx)("p",{className:"text-gray-500 text-center py-8 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:"No rules yet. Add a rule to start targeting specific users."}):(0,b.jsx)("div",{className:"space-y-4",children:y.rules.map((a,c)=>(0,b.jsx)("div",{className:"border-2 border-gray-200 rounded-lg p-5 space-y-4 bg-gray-50",children:(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,b.jsx)("input",{type:"text",value:a.description,onChange:b=>E(a.id,{description:b.target.value}),placeholder:"Rule description",className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg bg-white text-gray-900 focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("label",{className:"text-sm font-semibold text-gray-900",children:"Conditions (ALL must match)"}),(0,b.jsx)("button",{onClick:()=>{var b;let c;return b=a.id,c={attribute:"plan",operator:"eq",value:""},void z({...y,rules:y.rules.map(a=>a.id===b?{...a,conditions:[...a.conditions,c]}:a)})},className:"text-sm text-blue-600 hover:text-blue-700 font-medium",children:"+ Add Condition"})]}),a.conditions.map((c,d)=>(0,b.jsxs)("div",{className:"flex gap-2 items-center bg-white p-3 rounded-lg border border-gray-300",children:[(0,b.jsx)("input",{type:"text",value:c.attribute,onChange:b=>F(a.id,d,{attribute:b.target.value}),placeholder:"attribute (e.g., plan)",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900"}),(0,b.jsxs)("select",{value:c.operator,onChange:b=>F(a.id,d,{operator:b.target.value}),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900",children:[(0,b.jsx)("option",{value:"eq",children:"equals"}),(0,b.jsx)("option",{value:"ne",children:"not equals"}),(0,b.jsx)("option",{value:"contains",children:"contains"}),(0,b.jsx)("option",{value:"in",children:"in"}),(0,b.jsx)("option",{value:"gt",children:"greater than"}),(0,b.jsx)("option",{value:"lt",children:"less than"}),(0,b.jsx)("option",{value:"gte",children:"â‰¥"}),(0,b.jsx)("option",{value:"lte",children:"â‰¤"})]}),(0,b.jsx)("input",{type:"text",value:c.value,onChange:b=>F(a.id,d,{value:b.target.value}),placeholder:"value",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm bg-white text-gray-900"}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void z({...y,rules:y.rules.map(a=>a.id===b?{...a,conditions:a.conditions.filter((a,b)=>b!==d)}:a)})},className:"text-red-600 hover:text-red-700 text-xl font-bold px-2",children:"Ã—"})]},d))]}),(0,b.jsxs)("div",{className:"bg-white p-4 rounded-lg border border-gray-300",children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Rollout: ",a.rolloutPercentage,"%"]}),(0,b.jsx)("input",{type:"range",min:"0",max:"100",value:a.rolloutPercentage,onChange:b=>E(a.id,{rolloutPercentage:parseInt(b.target.value)}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Return Value"}),(0,b.jsx)("input",{type:"text",value:JSON.stringify(a.value),onChange:b=>{try{E(a.id,{value:JSON.parse(b.target.value)})}catch{}},className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg text-sm font-mono bg-white text-gray-900"})]})]}),(0,b.jsx)("button",{onClick:()=>{var b;return b=a.id,void z({...y,rules:y.rules.filter(a=>a.id!==b)})},className:"ml-4 text-red-600 hover:text-red-700 text-2xl",children:"ðŸ—‘ï¸"})]})},a.id))})]}),(0,b.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Default Rule"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mb-6",children:"Applied when no rules match"}),(0,b.jsxs)("div",{className:"space-y-5",children:[(0,b.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[(0,b.jsxs)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:["Rollout: ",y.defaultRule.rolloutPercentage,"%"]}),(0,b.jsx)("input",{type:"range",min:"0",max:"100",value:y.defaultRule.rolloutPercentage,onChange:a=>z({...y,defaultRule:{...y.defaultRule,rolloutPercentage:parseInt(a.target.value)}}),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"block text-sm font-semibold text-gray-900 mb-2",children:"Default Value"}),(0,b.jsx)("input",{type:"text",value:JSON.stringify(y.defaultRule.value),onChange:a=>{try{z({...y,defaultRule:{...y.defaultRule,value:JSON.parse(a.target.value)}})}catch{}},className:"w-full px-4 py-2 border-2 border-gray-300 rounded-lg font-mono bg-white text-gray-900"})]})]})]}),(0,b.jsx)("button",{onClick:D,className:"w-full py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold shadow-lg text-lg",children:"ðŸ’¾ Save Targeting Rules"})]})]})]})}):null}a.s(["default",()=>j])},71374,a=>{a.v(b=>Promise.all(["server/chunks/ssr/b3668_bcryptjs_index_cf2819b8.js"].map(b=>a.l(b))).then(()=>b(13954)))}];

//# sourceMappingURL=%5Broot-of-the-server%5D__c2240256._.js.map